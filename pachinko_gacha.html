<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>ãŠã™ã™ã‚å°ã‚¬ãƒãƒ£</title>
  <style>
    /* å…¨ä½“çš„ãªãƒªã‚»ãƒƒãƒˆ */
    * { margin: 0; padding: 0; box-sizing: border-box; }

    /* bodyã®ã‚¹ã‚¿ã‚¤ãƒ«: ãƒ•ã‚©ãƒ³ãƒˆã€èƒŒæ™¯ã‚°ãƒ©ãƒ‡ãƒ¼ã‚·ãƒ§ãƒ³ã€æœ€å°é«˜ã•ã€ãƒ‘ãƒ‡ã‚£ãƒ³ã‚° */
    body {
      font-family: 'Segoe UI', sans-serif;
      background: linear-gradient(135deg, #FF6F61 0%, #FFB6C1 100%); /* æ¸©ã‹ã„ãƒ”ãƒ³ã‚¯ç³»ã®ã‚°ãƒ©ãƒ‡ãƒ¼ã‚·ãƒ§ãƒ³ */
      min-height: 100vh;
      padding: 20px;
    }

    /* ãƒ¡ã‚¤ãƒ³ã‚³ãƒ³ãƒ†ãƒŠã®ã‚¹ã‚¿ã‚¤ãƒ« */
    .container {
      max-width: 800px;
      margin: 0 auto;
      background: white;
      border-radius: 20px;
      box-shadow: 0 20px 60px rgba(0,0,0,0.3);
      overflow: hidden;
      display: flex; /* Flexboxã§ã‚³ãƒ³ãƒ†ãƒ³ãƒ„ã‚’ä¸­å¤®å¯„ã› */
      flex-direction: column;
      align-items: center;
      min-height: calc(100vh - 40px); /* ãƒ˜ãƒƒãƒ€ãƒ¼ã¨ãƒ•ãƒƒã‚¿ãƒ¼ã‚’è€ƒæ…®ã—ãŸæœ€å°é«˜ã• */
    }

    /* ãƒ˜ãƒƒãƒ€ãƒ¼ã®ã‚¹ã‚¿ã‚¤ãƒ« */
    .header {
      background: linear-gradient(135deg, #FF6F61 0%, #FFB6C1 100%);
      color: white;
      padding: 30px;
      text-align: center;
      width: 100%; /* å¹…ã‚’100%ã« */
      box-sizing: border-box; /* ãƒ‘ãƒ‡ã‚£ãƒ³ã‚°ã‚’å«ã‚ã¦å¹…ã‚’è¨ˆç®— */
    }

    /* ãƒ˜ãƒƒãƒ€ãƒ¼ã®ã‚¿ã‚¤ãƒˆãƒ« */
    .header h1 { font-size: 28px; margin-bottom: 10px; }

    /* ãƒŠãƒ“ã‚²ãƒ¼ã‚·ãƒ§ãƒ³ãƒªãƒ³ã‚¯ã‚³ãƒ³ãƒ†ãƒŠã®ã‚¹ã‚¿ã‚¤ãƒ« */
    .nav-links {
      display: flex;
      gap: 10px;
      justify-content: center;
      flex-wrap: wrap;
      margin-top: 15px;
    }

    /* ãƒŠãƒ“ã‚²ãƒ¼ã‚·ãƒ§ãƒ³ãƒªãƒ³ã‚¯å€‹åˆ¥ã®ã‚¹ã‚¿ã‚¤ãƒ« */
    .nav-link {
      display: inline-block;
      padding: 10px 20px;
      background: rgba(255,255,255,0.2);
      color: white;
      text-decoration: none;
      border-radius: 8px;
      font-weight: 600;
      transition: all 0.3s;
    }

    /* ãƒŠãƒ“ã‚²ãƒ¼ã‚·ãƒ§ãƒ³ãƒªãƒ³ã‚¯ãƒ›ãƒãƒ¼æ™‚ã®ã‚¹ã‚¿ã‚¤ãƒ« */
    .nav-link:hover {
      background: rgba(255,255,255,0.3);
      transform: translateY(-2px);
    }

    /* ã‚³ãƒ³ãƒ†ãƒ³ãƒ„ã‚¨ãƒªã‚¢ã®ã‚¹ã‚¿ã‚¤ãƒ« */
    .content {
      padding: 30px;
      width: 100%; /* å¹…ã‚’100%ã« */
      max-width: 600px; /* ã‚³ãƒ³ãƒ†ãƒ³ãƒ„ã®æœ€å¤§å¹… */
      flex-grow: 1; /* æ®‹ã‚Šã®ã‚¹ãƒšãƒ¼ã‚¹ã‚’åŸ‹ã‚ã‚‹ */
      display: flex;
      flex-direction: column;
      align-items: center;
    }

    /* ãƒ•ã‚©ãƒ¼ãƒ ã‚»ã‚¯ã‚·ãƒ§ãƒ³ã®ã‚¹ã‚¿ã‚¤ãƒ« */
    .form-section {
      background: #f8f9fa;
      padding: 25px;
      border-radius: 15px;
      margin-bottom: 30px;
      width: 100%;
    }

    /* ãƒ•ã‚©ãƒ¼ãƒ ã‚»ã‚¯ã‚·ãƒ§ãƒ³ã®ã‚¿ã‚¤ãƒˆãƒ« */
    .form-section h2 {
      color: #FF6F61;
      margin-bottom: 20px;
      font-size: 20px;
      text-align: center;
    }

    /* ãƒ•ã‚©ãƒ¼ãƒ ã‚°ãƒ«ãƒ¼ãƒ— (ãƒ©ãƒ™ãƒ«ã¨å…¥åŠ›æ¬„ã®ã‚»ãƒƒãƒˆ) ã®ã‚¹ã‚¿ã‚¤ãƒ« */
    .form-group {
      margin-bottom: 20px;
      position: relative;
    }

    /* ãƒ©ãƒ™ãƒ«ã®ã‚¹ã‚¿ã‚¤ãƒ« */
    label {
      display: block;
      margin-bottom: 8px;
      font-weight: 600;
      color: #333;
    }

    /* inputã¨selectè¦ç´ ã®åŸºæœ¬ã‚¹ã‚¿ã‚¤ãƒ« */
    input, select {
      width: 100%;
      padding: 12px 15px;
      border: 2px solid #e0e0e0;
      border-radius: 10px;
      font-size: 16px;
      transition: all 0.3s;
    }

    /* inputã¨selectè¦ç´ ãƒ•ã‚©ãƒ¼ã‚«ã‚¹æ™‚ã®ã‚¹ã‚¿ã‚¤ãƒ« */
    input:focus, select:focus {
      outline: none;
      border-color: #FF6F61;
      box-shadow: 0 0 0 3px rgba(255, 111, 97, 0.1);
    }

    /* ãƒœã‚¿ãƒ³ã®åŸºæœ¬ã‚¹ã‚¿ã‚¤ãƒ« */
    .btn {
      width: 100%;
      padding: 15px;
      border: none;
      border-radius: 10px;
      font-size: 16px;
      font-weight: 600;
      cursor: pointer;
      background: linear-gradient(135deg, #FF6F61 0%, #FFB6C1 100%);
      color: white;
      transition: all 0.3s;
    }

    /* ãƒœã‚¿ãƒ³ãƒ›ãƒãƒ¼æ™‚ã®ã‚¹ã‚¿ã‚¤ãƒ« */
    .btn:hover {
      transform: translateY(-2px);
      box-shadow: 0 5px 20px rgba(255, 111, 97, 0.4);
    }

    /* è¤‡æ•°é¸æŠãƒªã‚¹ãƒˆã®ã‚¹ã‚¿ã‚¤ãƒ« */
    #machine-selection {
      width: 100%;
      min-height: 150px;
      border: 2px solid #e0e0e0;
      border-radius: 10px;
      font-size: 16px;
      padding: 10px;
      overflow-y: auto;
      background-color: white;
    }

    #machine-selection option {
      padding: 8px 10px;
      cursor: pointer;
    }

    #machine-selection option:checked {
      background: #ffe0e0; /* é¸æŠæ™‚ã®èƒŒæ™¯è‰² */
      color: #333;
    }

    /* ã‚¬ãƒãƒ£çµæœè¡¨ç¤ºã‚¨ãƒªã‚¢ */
    .gacha-result {
      background: #fff0f0; /* è–„ã„ãƒ”ãƒ³ã‚¯ã®èƒŒæ™¯ */
      border: 2px solid #FF6F61;
      border-radius: 15px;
      padding: 30px;
      text-align: center;
      margin-top: 30px;
      width: 100%;
      animation: fadeIn 1s ease-out; /* ãƒ•ã‚§ãƒ¼ãƒ‰ã‚¤ãƒ³ã‚¢ãƒ‹ãƒ¡ãƒ¼ã‚·ãƒ§ãƒ³ */
    }

    .gacha-result h3 {
      color: #FF6F61;
      font-size: 24px;
      margin-bottom: 15px;
    }

    .gacha-result p {
      font-size: 18px;
      color: #555;
      line-height: 1.6;
    }

    .gacha-machine-name {
      font-size: 36px;
      font-weight: 700;
      color: #E91E63; /* æ¿ƒã„ãƒ”ãƒ³ã‚¯ */
      margin: 20px 0;
      text-shadow: 2px 2px 5px rgba(0,0,0,0.1);
    }

    @keyframes fadeIn {
      from { opacity: 0; transform: translateY(20px); }
      to { opacity: 1; transform: translateY(0); }
    }

    /* ã‚µã‚¸ã‚§ã‚¹ãƒˆãƒœãƒƒã‚¯ã‚¹ã®ã‚¹ã‚¿ã‚¤ãƒ« */
    .suggest-box {
      position: absolute;
      top: 100%;
      left: 0;
      right: 0;
      background: white;
      border: 2px solid #FF6F61;
      border-top: none;
      border-radius: 0 0 10px 10px;
      max-height: 200px;
      overflow-y: auto;
      z-index: 10;
      box-shadow: 0 10px 20px rgba(0,0,0,0.1);
    }

    .suggest-box div {
      padding: 12px 15px;
      cursor: pointer;
      transition: all 0.2s;
    }

    .suggest-box div:hover {
      background: #ffe0e0;
    }
  </style>
</head>
<body>
  <div class="container">
    <div class="header">
      <h1>ğŸ° ãŠã™ã™ã‚å°ã‚¬ãƒãƒ£</h1>
      <p>ä»Šæ—¥ã®é‹è©¦ã—ï¼ã©ã®å°ã‚’æ‰“ã¤ï¼Ÿ</p>
      <!-- ãƒŠãƒ“ã‚²ãƒ¼ã‚·ãƒ§ãƒ³ãƒªãƒ³ã‚¯ -->
      <div class="nav-links">
        <a href="index.html" class="nav-link">ğŸ  å®¶è¨ˆç°¿ãƒ›ãƒ¼ãƒ </a>
        <a href="register.html" class="nav-link">ğŸ“ æ©Ÿç¨®ç™»éŒ²</a>
        <a href="pachinko_index.html" class="nav-link">ğŸ° åæ”¯ç™»éŒ²</a>
        <a href="pachinko_calendar.html" class="nav-link">ğŸ“… ã‚«ãƒ¬ãƒ³ãƒ€ãƒ¼</a>
        <a href="pachinko_graph.html" class="nav-link">ğŸ“Š ã‚°ãƒ©ãƒ•</a>
      
    </div>
    </div>

    <div class="content">
      <div class="form-section">
        <h2>ğŸ’¡ ã‚¬ãƒãƒ£ã‚’å›ã™å°ã‚’é¸ã¶</h2>
        <form id="gacha-form">
          <div class="form-group">
            <label for="gacha-genre-filter">ã‚¸ãƒ£ãƒ³ãƒ«ã§çµã‚Šè¾¼ã¿</label>
            <select id="gacha-genre-filter">
              <option value="all">å…¨ã¦</option>
              <option value="pachislot">ğŸ° ãƒ‘ãƒã‚¹ãƒ­</option>
              <option value="pachinko">ğŸ¯ ãƒ‘ãƒãƒ³ã‚³</option>
            </select>
          </div>

          <div class="form-group" style="position: relative;">
            <label for="gacha-machine-input">æ©Ÿç¨®åã‚’æ¤œç´¢ãƒ»è¿½åŠ </label>
            <input type="text" id="gacha-machine-input" placeholder="æ©Ÿç¨®åã‚’å…¥åŠ›ã—ã¦è¿½åŠ " autocomplete="off">
            <div id="gacha-suggestions" class="suggest-box"></div>
          </div>
          
          <div class="form-group">
            <label for="machine-selection">ã‚¬ãƒãƒ£å¯¾è±¡ã®å°ãƒªã‚¹ãƒˆ (è¤‡æ•°é¸æŠå¯èƒ½)</label>
            <select id="machine-selection" multiple size="8">
              <!-- JavaScriptã§å‹•çš„ã«ã‚ªãƒ—ã‚·ãƒ§ãƒ³ãŒè¿½åŠ ã•ã‚Œã¾ã™ -->
            </select>
            <button type="button" class="btn btn-delete" style="margin-top: 10px; background: #e74c3c;" onclick="removeSelectedMachines()">é¸æŠã—ãŸå°ã‚’å‰Šé™¤</button>
          </div>

          <button type="submit" class="btn">ğŸš€ ã‚¬ãƒãƒ£ã‚’å›ã™ï¼</button>
        </form>
      </div>

      <!-- ã‚¬ãƒãƒ£çµæœè¡¨ç¤ºã‚¨ãƒªã‚¢ -->
      <div id="gacha-result" class="gacha-result" style="display: none;">
        <h3>ä»Šæ—¥ã®ã‚ãªãŸã«ãŠã™ã™ã‚ã®å°ã¯ã“ã‚Œã ï¼</h3>
        <p>ã‚¸ãƒ£ãƒ³ãƒ«: <span id="gacha-result-genre"></span></p>
        <div class="gacha-machine-name" id="gacha-result-machine-name"></div>
        <p>ã‚¿ã‚¤ãƒ—: <span id="gacha-result-type"></span></p>
      </div>
    </div>
  </div>

  <script>
    // ------------------------------
    // ğŸ”§ åˆæœŸãƒ‡ãƒ¼ã‚¿èª­ã¿è¾¼ã¿ (pachinko_script.js ã¨å…±æœ‰)
    // ------------------------------
    let baseMachines = []; // å¤–éƒ¨JSONã‹ã‚‰èª­ã¿è¾¼ã‚€åŸºæœ¬æ©Ÿç¨®ãƒªã‚¹ãƒˆ
    let userMachines = JSON.parse(localStorage.getItem("userMachines") || "[]"); // ãƒ¦ãƒ¼ã‚¶ãƒ¼ãŒè¿½åŠ ã—ãŸæ©Ÿç¨®

    fetch("dmmMachines.json")
      .then(res => res.json())
      .then(data => {
        baseMachines = data;
        loadMachinesForGacha(); // ã‚¬ãƒãƒ£ç”¨ãƒªã‚¹ãƒˆã‚’åˆæœŸè¡¨ç¤º
      })
      .catch(error => console.error("Error loading dmmMachines.json for gacha:", error));

    // ------------------------------
    // ğŸ§  æ­£è¦åŒ–ãƒ»ç•¥ç§°å‡¦ç† (pachinko_script.js ã¨å…±æœ‰)
    // ------------------------------
    // pachinko_script.js ã¨åŒã˜ normalizeName ã¨ aliasMap, resolveAlias ã‚’ã“ã“ã«ã‚³ãƒ”ãƒ¼
    // ã¾ãŸã¯ã€pachinko_script.js ã‹ã‚‰ã‚¨ã‚¯ã‚¹ãƒãƒ¼ãƒˆã—ã¦åˆ©ç”¨ã™ã‚‹ã‚ˆã†ã«å¤‰æ›´

    /**
     * æ©Ÿç¨®åã‚’æ­£è¦åŒ–ã™ã‚‹é–¢æ•°
     * - ä¸è¦ãªè¨˜å·ã‚„æ©Ÿç¨®ã‚¿ã‚¤ãƒ—ã‚’ç¤ºã™ã‚­ãƒ¼ãƒ¯ãƒ¼ãƒ‰ã‚’é™¤å»
     * - ã‚¹ãƒšãƒ¼ã‚¹ã‚’é™¤å»ã—ã€å°æ–‡å­—ã«å¤‰æ›
     * @param {string} name - æ­£è¦åŒ–ã™ã‚‹æ©Ÿç¨®å
     * @returns {string} æ­£è¦åŒ–ã•ã‚ŒãŸæ©Ÿç¨®å
     */
    function normalizeName(name) {
      return name
        .replace(/[^\p{Script=Hiragana}\p{Script=Katakana}\p{Script=Han}a-zA-Z0-9ãƒ¼]/gu, "") // æ—¥æœ¬èªã€è‹±æ•°å­—ã€é•·éŸ³è¨˜å·ä»¥å¤–ã®è¨˜å·ã‚’é™¤å»
        .replace(/ã‚¹ãƒã‚¹ãƒ­|Aã‚¿ã‚¤ãƒ—|AT|ART|SLOT|ãƒ‘ãƒãƒ³ã‚³|ãƒ‘ãƒã‚¹ãƒ­|CR|P/gi, "") // æ©Ÿç¨®ã‚¿ã‚¤ãƒ—ã«é–¢ã™ã‚‹ã‚­ãƒ¼ãƒ¯ãƒ¼ãƒ‰ã‚’é™¤å» (å¤§æ–‡å­—å°æ–‡å­—ã‚’åŒºåˆ¥ã—ãªã„)
        .replace(/\s/g, "") // ã‚¹ãƒšãƒ¼ã‚¹ã‚’é™¤å»
        .toLowerCase(); // å°æ–‡å­—ã«å¤‰æ›
    }

    // æ©Ÿç¨®åã®ç•¥ç§°ã‚„åˆ¥åã‚’ãƒãƒƒãƒ”ãƒ³ã‚°ã™ã‚‹ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆ
    const aliasMap = {
      "æ±äº¬å–°ç¨®": ["ã‚°ãƒ¼ãƒ«", "æ±äº¬ã‚°ãƒ¼ãƒ«", "å–°ç¨®"],
      "åŒ—æ–—ã®æ‹³": ["åŒ—æ–—", "ãƒ›ã‚¯ãƒˆ"],
      "ãƒã‚¸ãƒªã‚¹ã‚¯çµ†2": ["çµ†", "ãƒã‚¸2", "çµ†2"],
      "ãƒ¢ãƒ³ã‚­ãƒ¼ã‚¿ãƒ¼ãƒ³": ["ãƒ¢ãƒ³ã‚­ãƒ¼", "çŒ¿"],
      "ã‹ã‚‰ãã‚Šã‚µãƒ¼ã‚«ã‚¹": ["ã‹ã‚‰ã‚µ", "ã‹ã‚‰ãã‚Š"],
      "ã‹ãã‚„æ§˜ã¯å‘Šã‚‰ã›ãŸã„": ["ã‹ãã‚„æ§˜", "ã‹ãã‚„"],
      "Re:ã‚¼ãƒ­ã‹ã‚‰å§‹ã‚ã‚‹ç•°ä¸–ç•Œç”Ÿæ´» season2": ["ãƒªã‚¼ãƒ­", "Re:ã‚¼ãƒ­", "rezero"],
      "ã‚³ãƒ¼ãƒ‰ã‚®ã‚¢ã‚¹ åé€†ã®ãƒ«ãƒ«ãƒ¼ã‚·ãƒ¥/å¾©æ´»ã®ãƒ«ãƒ«ãƒ¼ã‚·ãƒ¥": ["ã‚®ã‚¢ã‚¹", "ã‚³ãƒ¼ãƒ‰ã‚®ã‚¢ã‚¹"],
      "ç‚ç‚ãƒæ¶ˆé˜²éšŠ": ["ç‚ç‚"],
      "ã‚´ãƒ–ãƒªãƒ³ã‚¹ãƒ¬ã‚¤ãƒ¤ãƒ¼": ["ã‚´ãƒ–ã‚¹ãƒ¬"],
      "ãƒ€ãƒ³ã‚¸ãƒ§ãƒ³ã«å‡ºä¼šã„ã‚’æ±‚ã‚ã‚‹ã®ã¯é–“é•ã£ã¦ã„ã‚‹ã ã‚ã†ã‹2": ["ãƒ€ãƒ³ã¾ã¡"],
      "è»¢ç”Ÿã—ãŸã‚‰ã‚¹ãƒ©ã‚¤ãƒ ã ã£ãŸä»¶": ["è»¢ã‚¹ãƒ©"],
      "ã¨ã‚ã‚‹é­”è¡“ã®ç¦æ›¸ç›®éŒ²": ["ã¨ã‚ã‚‹"],
      "ãƒã‚¤ã‚ªãƒã‚¶ãƒ¼ãƒ‰:ãƒ´ã‚§ãƒ³ãƒ‡ãƒƒã‚¿": ["ãƒã‚¤ã‚ª"],
      "é¬¼æ­¦è€…3": ["é¬¼æ­¦è€…"],
      "ãƒã‚¯ãƒ­ã‚¹ãƒ•ãƒ­ãƒ³ãƒ†ã‚£ã‚¢4": ["ãƒã‚¯ãƒ­ã‚¹F"],
      "ã²ãã‚‰ã—ã®ãªãé ƒã« æ¥­": ["ã²ãã‚‰ã—"],
      "ã‚½ãƒ¼ãƒ‰ã‚¢ãƒ¼ãƒˆãƒ»ã‚ªãƒ³ãƒ©ã‚¤ãƒ³": ["SAO", "sao"],
      "åŠ‡å ´ç‰ˆ é­”æ³•å°‘å¥³ã¾ã©ã‹â˜†ãƒã‚®ã‚« [æ–°ç·¨] å›é€†ã®ç‰©èª": ["ã¾ã©ãƒã‚®", "ã¾ã©ã‹"],
      "æˆ¦å›½ä¹™å¥³4 æˆ¦ä¹±ã«é–ƒãç‚¯çœ¼ã®è»å¸«": ["æˆ¦å›½ä¹™å¥³"],
      "ç”²é‰„åŸã®ã‚«ãƒãƒãƒª": ["ã‚«ãƒãƒãƒª"],
      "äº¤éŸ¿è©©ç¯‡ã‚¨ã‚¦ãƒ¬ã‚«ã‚»ãƒ–ãƒ³4 HI-EVOLUTION": ["ã‚¨ã‚¦ãƒ¬ã‚«", "ã‚¨ã‚¦ãƒ¬ã‚«ã‚»ãƒ–ãƒ³"],
      "ã‚´ãƒ¼ãƒ«ãƒ‡ãƒ³ã‚«ãƒ ã‚¤": ["é‡‘ã‚«ãƒ "],
      "ãƒ‡ãƒ“ãƒ« ãƒ¡ã‚¤ ã‚¯ãƒ©ã‚¤5": ["DMC", "ãƒ‡ãƒ“ãƒ«ãƒ¡ã‚¤ã‚¯ãƒ©ã‚¤"],
      "ã‚®ãƒ«ãƒ†ã‚£ã‚¯ãƒ©ã‚¦ãƒ³2": ["ã‚®ãƒ«ã‚¯ãƒ©"],
      "æŠ¼å¿ï¼ç•ªé•·ZERO": ["ç•ªé•·ã‚¼ãƒ­"],
      "æŠ¼å¿ï¼ç•ªé•·4": ["ç•ªé•·4"],
      "Re:ã‚¼ãƒ­ã‹ã‚‰å§‹ã‚ã‚‹ç•°ä¸–ç•Œç”Ÿæ´» season2": ["ãƒªã‚¼ãƒ­"],
      "ãƒ±ãƒ´ã‚¡ãƒ³ã‚²ãƒªãƒ²ãƒ³ ï½ç´„æŸã®æ‰‰ï½": ["ã‚¨ãƒ´ã‚¡", "eva"],
      "çœŸãƒ»èŠ±ã®æ…¶æ¬¡": ["æ…¶æ¬¡", "ã‘ã„ã˜"],
      "ãƒ¢ãƒ³ã‚¹ã‚¿ãƒ¼ãƒãƒ³ã‚¿ãƒ¼ãƒ¯ãƒ¼ãƒ«ãƒ‰ï¼šã‚¢ã‚¤ã‚¹ãƒœãƒ¼ãƒ³": ["ãƒ¢ãƒ³ãƒãƒ³ã‚¢ã‚¤ã‚¹ãƒœãƒ¼ãƒ³", "MHã‚¢ã‚¤ã‚¹ãƒœãƒ¼ãƒ³"],
      "ã‚¹ãƒã‚¹ãƒ­ãƒã‚¸ãƒªã‚¹ã‚¯ï½ç”²è³€å¿æ³•å¸–ï½çµ†2 å¤©è†³ BLACK EDITION": ["çµ†2å¤©è†³"],
      "SLOTãƒã‚¸ãƒªã‚¹ã‚¯çµ†2": ["çµ†2"],
      "ã‚¹ãƒã‚¹ãƒ­ æ²–ãƒ‰ã‚­ï¼DUOã‚¢ãƒ³ã‚³ãƒ¼ãƒ«": ["æ²–ãƒ‰ã‚­DUO"],
      "ã‚¹ãƒã‚¹ãƒ­ æ²–ãƒ‰ã‚­ï¼GOLD": ["æ²–ãƒ‰ã‚­GOLD"],
      "æ²–ãƒ‰ã‚­ï¼GOLDï¼ˆ-30ï¼‰": ["æ²–ãƒ‰ã‚­GOLD-30"],
      "æ²–ãƒ‰ã‚­ï¼DUO": ["æ²–ãƒ‰ã‚­DUO"],
      "æ²–ãƒ‰ã‚­ï¼BLACK": ["æ²–ãƒ‰ã‚­BLACK"],
      "æ²–ãƒ‰ã‚­ï¼ã‚´ãƒ¼ã‚¸ãƒ£ã‚¹": ["æ²–ãƒ‰ã‚­ã‚´ãƒ¼ã‚¸ãƒ£ã‚¹"],
      "ã‚¹ãƒã‚¹ãƒ­ ã‚´ãƒ¼ã‚´ãƒ¼ã‚¸ãƒ£ã‚°ãƒ©ãƒ¼3": ["ã‚´ãƒ¼ã‚¸ãƒ£ã‚°3"],
      "ã‚¹ãƒã‚¹ãƒ­ ãƒã‚¤ã‚¸ãƒ£ã‚°ãƒ©ãƒ¼V": ["ãƒã‚¤ã‚¸ãƒ£ã‚°V"],
      "ã‚¹ãƒã‚¹ãƒ­ ãƒ•ã‚¡ãƒ³ã‚­ãƒ¼ã‚¸ãƒ£ã‚°ãƒ©ãƒ¼2": ["ãƒ•ã‚¡ãƒ³ã‚­ãƒ¼2"],
      "ã‚¹ãƒã‚¹ãƒ­ ã‚¢ã‚¤ãƒ ã‚¸ãƒ£ã‚°ãƒ©ãƒ¼EX": ["ã‚¢ã‚¤ãƒ EX"],
      "ã‚´ãƒ¼ã‚´ãƒ¼ã‚¸ãƒ£ã‚°ãƒ©ãƒ¼": ["ã‚´ãƒ¼ã‚¸ãƒ£ã‚°"],
      "ãƒã‚ªã‚¢ã‚¤ãƒ ã‚¸ãƒ£ã‚°ãƒ©ãƒ¼": ["ãƒã‚ªã‚¢ã‚¤ãƒ "],
      "ãƒ‹ãƒ¥ãƒ¼ã‚¢ã‚¤ãƒ ã‚¸ãƒ£ã‚°ãƒ©ãƒ¼EX": ["ãƒ‹ãƒ¥ãƒ¼ã‚¢ã‚¤ãƒ EX"],
      "ãƒãƒƒãƒ”ãƒ¼ã‚¸ãƒ£ã‚°ãƒ©ãƒ¼VIII": ["ãƒãƒƒãƒ”ãƒ¼ã‚¸ãƒ£ã‚°ãƒ©ãƒ¼"],
      "ã‚¸ãƒ£ã‚°ãƒ©ãƒ¼ã‚¬ãƒ¼ãƒ«ã‚ºSS": ["ã‚¸ãƒ£ã‚°ãƒ©ãƒ¼ã‚¬ãƒ¼ãƒ«ã‚º"],
      "ãƒ‹ãƒ¥ãƒ¼ã‚­ãƒ³ã‚°ãƒãƒŠãƒãƒŠ": ["ãƒ‹ãƒ¥ãƒ¼ã‚­ãƒ³ã‚°"],
      "ãƒãƒŠãƒãƒŠãƒ›ã‚¦ã‚ªã‚¦ï½å¤©ç¿”ï½": ["ãƒãƒŠãƒãƒŠå¤©ç¿”"],
      "ãƒ—ãƒ¬ãƒŸã‚¢ãƒ ãƒãƒŠãƒãƒŠ": ["ãƒ—ãƒ¬ãƒŸã‚¢ãƒ ãƒãƒŠãƒãƒŠ"],
      "ãƒãƒ¼ã‚µã‚¹ ãƒªãƒ´ã‚¡ã‚¤ã‚º": ["ãƒãƒ¼ã‚µã‚¹"],
      "ãƒ‘ãƒã‚¹ãƒ­æ±äº¬å–°ç¨®": ["æ±äº¬å–°ç¨®"],
      "ãƒ‘ãƒã‚¹ãƒ­æˆ¦å›½ä¹™å¥³ æšã®é–¢ãƒ¶åŸ": ["æˆ¦å›½ä¹™å¥³"],
      "ãƒ‘ãƒã‚¹ãƒ­é»„é–€ã¡ã‚ƒã¾å–2": ["é»„é–€ã¡ã‚ƒã¾å–2"],
      "ãƒ‘ãƒã‚¹ãƒ­ é©å‘½æ©Ÿãƒ´ã‚¡ãƒ«ãƒ´ãƒ¬ã‚¤ãƒ´": ["ãƒ´ã‚¡ãƒ«ãƒ´ãƒ¬ã‚¤ãƒ´"],
      "ãƒ‘ãƒã‚¹ãƒ­æ©Ÿå‹•æˆ¦å£«ã‚¬ãƒ³ãƒ€ãƒ  ãƒ¦ãƒ‹ã‚³ãƒ¼ãƒ³": ["ã‚¬ãƒ³ãƒ€ãƒ ãƒ¦ãƒ‹ã‚³ãƒ¼ãƒ³"],
      "ãƒ‘ãƒã‚¹ãƒ­ ãƒ¢ãƒ³ã‚¹ã‚¿ãƒ¼ãƒãƒ³ã‚¿ãƒ¼ãƒ¯ãƒ¼ãƒ«ãƒ‰ï¼šã‚¢ã‚¤ã‚¹ãƒœãƒ¼ãƒ³": ["ãƒ¢ãƒ³ãƒãƒ³ã‚¢ã‚¤ã‚¹ãƒœãƒ¼ãƒ³"],
      "ãƒ‘ãƒã‚¹ãƒ­æ”¿å®— æˆ¦æ¥µ": ["æ”¿å®—æˆ¦æ¥µ"],
      "ãƒ‘ãƒã‚¹ãƒ­èŠ±ã®æ…¶æ¬¡": ["èŠ±ã®æ…¶æ¬¡"],
      "ãƒ‘ãƒã‚¹ãƒ­é»„é–€ã¡ã‚ƒã¾Vå¥³ç¥ç››-MEGAMORI-": ["é»„é–€ã¡ã‚ƒã¾å¥³ç¥ç››"],
      "Sã‚¢ã‚¤ãƒ‰ãƒ«ãƒã‚¹ã‚¿ãƒ¼ ãƒŸãƒªã‚ªãƒ³ãƒ©ã‚¤ãƒ–ï¼": ["ã‚¢ã‚¤ãƒã‚¹ãƒŸãƒªã‚ªãƒ³"],
      "Sã‚­ãƒ³è‚‰ãƒãƒ³ï½7äººã®æ‚ªé­”è¶…äººç·¨ï½": ["ã‚­ãƒ³è‚‰ãƒãƒ³"],
      "Lãƒ‘ãƒã‚¹ãƒ­ã‚¬ãƒ¼ãƒ«ã‚º&ãƒ‘ãƒ³ãƒ„ã‚¡ãƒ¼åŠ‡å ´ç‰ˆ": ["ã‚¬ãƒ«ãƒ‘ãƒ³åŠ‡å ´ç‰ˆ"],
      "Lè–é—˜å£«æ˜ŸçŸ¢ æµ·çš‡è¦šé†’Special": ["è–é—˜å£«æ˜ŸçŸ¢SP"],
      "Lè–é—˜å£«æ˜ŸçŸ¢ æµ·çš‡è¦šé†’ CUSTOM EDITION": ["è–é—˜å£«æ˜ŸçŸ¢CE"],
      "Læˆ¦å›½BASARA HEROES PARTY": ["æˆ¦å›½BASARA"],
      "ãƒ‘ãƒã‚¹ãƒ­ ã‚·ãƒ³ãƒ»ã‚¨ãƒ´ã‚¡ãƒ³ã‚²ãƒªã‚ªãƒ³ ã‚¿ã‚¤ãƒ— ã‚«ãƒ²ãƒ«": ["ã‚·ãƒ³ã‚¨ãƒ´ã‚¡"],
      "ã‚¹ãƒã‚¹ãƒ­ é ­æ–‡å­—D 2nd Stage": ["é ­æ–‡å­—D"],
      "ã‚¹ãƒã‚¹ãƒ­ ãƒ•ã‚¡ã‚¤ãƒ¤ãƒ¼ãƒ‰ãƒªãƒ•ãƒˆ": ["ãƒ•ã‚¡ã‚¤ãƒ¤ãƒ¼ãƒ‰ãƒªãƒ•ãƒˆ"],
      "ã‚¹ãƒã‚¹ãƒ­ ãƒãƒ™ãƒ«": ["ãƒãƒ™ãƒ«"],
      "ã‚¹ãƒã‚¹ãƒ­ éŠ­å½¢5": ["éŠ­å½¢"],
      "ã‚¹ãƒã‚¹ãƒ­ ã‚µãƒ©ãƒªãƒ¼ãƒãƒ³é‡‘å¤ªéƒ": ["é‡‘å¤ªéƒ"],
      "ã‚¹ãƒã‚¹ãƒ­ ãƒ‡ã‚£ã‚¹ã‚¯ã‚¢ãƒƒãƒ—": ["ãƒ‡ã‚£ã‚¹ã‚¯ã‚¢ãƒƒãƒ—"],
      "ã‚¹ãƒã‚¹ãƒ­ ãƒ€ãƒ³ãƒ™ãƒ«ä½•ã‚­ãƒ­æŒã¦ã‚‹ï¼Ÿ": ["ãƒ€ãƒ³ãƒ™ãƒ«"],
      "ã‚¹ãƒã‚¹ãƒ­ ç·‘ãƒ‰ãƒ³ VIVA!æƒ…ç†±å—ç±³ç·¨ REVIVAL": ["ç·‘ãƒ‰ãƒ³"],
      "ã‚¹ãƒã‚¹ãƒ­ ã‚¹ãƒ¼ãƒ‘ãƒ¼ãƒ“ãƒ³ã‚´ãƒã‚ª": ["ãƒ“ãƒ³ã‚´ãƒã‚ª"],
      "ã‚¹ãƒã‚¹ãƒ­ å‰å®—RISING": ["å‰å®—"],
      "Lå‰å®—": ["å‰å®—"],
      "L ã‚¢ã‚ºãƒ¼ãƒ«ãƒ¬ãƒ¼ãƒ³ THE ANIMATION": ["ã‚¢ã‚ºãƒ¼ãƒ«ãƒ¬ãƒ¼ãƒ³"],
      "ãƒ‘ãƒã‚¹ãƒ­ è»¢ç”Ÿã—ãŸã‚‰å‰£ã§ã—ãŸ": ["è»¢ã‚¹ãƒ©å‰£"],
      "ã‚ãŸã—ã®å¹¸ã›ãªçµå©š": ["ã‚ãŸå©š"],
      "Lãƒ‘ãƒã‚¹ãƒ­ ã‚ã‚Šãµã‚ŒãŸè·æ¥­ã§ä¸–ç•Œæœ€å¼·": ["ã‚ã‚Šãµã‚ŒãŸ"],
      "Lå°‘å¥³â˜†æ­ŒåŠ‡ ãƒ¬ãƒ´ãƒ¥ãƒ¼ã‚¹ã‚¿ã‚¡ãƒ©ã‚¤ãƒˆ": ["ã‚¹ã‚¿ã‚¡ãƒ©ã‚¤ãƒˆ"],
      "LBãƒ‘ãƒã‚¹ãƒ­ ãƒ±ãƒ´ã‚¡ãƒ³ã‚²ãƒªãƒ²ãƒ³ ï½ç´„æŸã®æ‰‰ï½": ["ã‚¨ãƒ´ã‚¡"]
    };

    /**
     * å…¥åŠ›ã•ã‚ŒãŸæ©Ÿç¨®åãŒç•¥ç§°ã®å ´åˆã€æ­£å¼åç§°ã‚’è§£æ±ºã™ã‚‹é–¢æ•°
     * @param {string} input - ãƒ¦ãƒ¼ã‚¶ãƒ¼ãŒå…¥åŠ›ã—ãŸæ©Ÿç¨®å
     * @returns {string} è§£æ±ºã•ã‚ŒãŸæ­£å¼åç§°ã€ã¾ãŸã¯å…ƒã®å…¥åŠ›
     */
    function resolveAlias(input) {
      const normalizedInput = normalizeName(input);
      for (const [official, aliases] of Object.entries(aliasMap)) {
        if (normalizedInput.includes(normalizeName(official))) {
          return official;
        }
        if (aliases.some(alias => normalizedInput.includes(normalizeName(alias)))) {
          return official;
        }
      }
      return input;
    }

    // ------------------------------
    // ğŸ² ã‚¬ãƒãƒ£æ©Ÿèƒ½ã®ãƒ­ã‚¸ãƒƒã‚¯
    // ------------------------------
    const gachaForm = document.getElementById("gacha-form");
    const gachaMachineInput = document.getElementById("gacha-machine-input");
    const gachaSuggestionsBox = document.getElementById("gacha-suggestions");
    const gachaGenreFilter = document.getElementById("gacha-genre-filter");
    const machineSelection = document.getElementById("machine-selection");
    const gachaResultDiv = document.getElementById("gacha-result");
    const gachaResultMachineName = document.getElementById("gacha-result-machine-name");
    const gachaResultGenre = document.getElementById("gacha-result-genre");
    const gachaResultType = document.getElementById("gacha-result-type");

    let gachaMachines = JSON.parse(localStorage.getItem("gachaMachines") || "[]"); // ã‚¬ãƒãƒ£å¯¾è±¡ã¨ã—ã¦ä¿å­˜ã•ã‚ŒãŸæ©Ÿç¨®ãƒªã‚¹ãƒˆ

    /**
     * ã‚¬ãƒãƒ£å¯¾è±¡ã®æ©Ÿç¨®ãƒªã‚¹ãƒˆ (machine-selection) ã‚’UIã«è¡¨ç¤ºã™ã‚‹
     */
    function renderGachaMachines() {
      machineSelection.innerHTML = ""; // æ—¢å­˜ã‚ªãƒ—ã‚·ãƒ§ãƒ³ã‚’ã‚¯ãƒªã‚¢
      if (gachaMachines.length === 0) {
        const option = document.createElement("option");
        option.textContent = "ã‚¬ãƒãƒ£å¯¾è±¡ã®å°ã‚’è¿½åŠ ã—ã¦ãã ã•ã„";
        option.disabled = true;
        machineSelection.appendChild(option);
        return;
      }
      gachaMachines.forEach((machine, index) => {
        const option = document.createElement("option");
        const genreIcon = machine.genre === 'pachinko' ? 'ğŸ¯' : 'ğŸ°';
        option.value = index; // é…åˆ—ã‚¤ãƒ³ãƒ‡ãƒƒã‚¯ã‚¹ã‚’valueã«è¨­å®š
        option.textContent = `${genreIcon} ${machine.name} (${machine.type})`;
        machineSelection.appendChild(option);
      });
    }

    /**
     * ãƒ­ãƒ¼ã‚«ãƒ«ã‚¹ãƒˆãƒ¬ãƒ¼ã‚¸ã‹ã‚‰ã‚¬ãƒãƒ£å¯¾è±¡ã®æ©Ÿç¨®ã‚’èª­ã¿è¾¼ã¿ã€UIã‚’æ›´æ–°ã™ã‚‹
     */
    function loadMachinesForGacha() {
      gachaMachines = JSON.parse(localStorage.getItem("gachaMachines") || "[]");
      renderGachaMachines();
    }

    /**
     * æ©Ÿç¨®æ¤œç´¢ãƒ»è¿½åŠ å…¥åŠ›ãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰ã®ã‚µã‚¸ã‚§ã‚¹ãƒˆæ©Ÿèƒ½
     */
    gachaMachineInput.addEventListener("input", function() {
      const rawInput = this.value.trim();
      const input = normalizeName(resolveAlias(rawInput));
      gachaSuggestionsBox.innerHTML = "";

      if (!input || input.length < 1) return;

      const selectedGenreFilter = gachaGenreFilter.value;
      const allAvailableMachines = [...baseMachines, ...userMachines];

      const filteredByGenre = allAvailableMachines.filter(m => 
        selectedGenreFilter === 'all' || m.genre === selectedGenreFilter || !m.genre // ã‚¸ãƒ£ãƒ³ãƒ«ãŒè¨­å®šã•ã‚Œã¦ã„ãªã„æ©Ÿç¨®ã‚‚è¡¨ç¤ºå¯¾è±¡ã«ã™ã‚‹
      );

      const exactMatches = filteredByGenre.filter(m =>
        normalizeName(m.name).startsWith(input)
      );
      const partialMatches = filteredByGenre.filter(m =>
        normalizeName(m.name).includes(input) && !normalizeName(m.name).startsWith(input)
      );
      const matches = [...exactMatches, ...partialMatches];

      if (matches.length === 0 && rawInput.length >= 2) {
        const div = document.createElement("div");
        div.style.color = "#888";
        div.style.fontStyle = "italic";
        div.textContent = `"${rawInput}" ã‚’è¿½åŠ `;
        div.onclick = () => {
          // ã‚¸ãƒ£ãƒ³ãƒ«ãƒ•ã‚£ãƒ«ã‚¿ã®é¸æŠå€¤ã‚’ã‚¸ãƒ£ãƒ³ãƒ«ã¨ã—ã¦ä½¿ç”¨
          const genreToAdd = selectedGenreFilter !== 'all' ? selectedGenreFilter : 'pachislot'; // ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆã¯ãƒ‘ãƒã‚¹ãƒ­
          addMachineToGachaList({ name: rawInput, genre: genreToAdd, type: 'ä¸æ˜' }); // ã‚¿ã‚¤ãƒ—ã¯ä¸æ˜ã¨ã—ã¦è¿½åŠ 
          gachaMachineInput.value = "";
          gachaSuggestionsBox.innerHTML = "";
        };
        gachaSuggestionsBox.appendChild(div);
        return;
      }

      matches.slice(0, 10).forEach(m => {
        const div = document.createElement("div");
        const genreIcon = (m.genre === 'pachinko' || m.type?.includes('ãƒ‡ã‚¸ãƒ‘ãƒ')) ? 'ğŸ¯' : 'ğŸ°';
        div.textContent = `${genreIcon} ${m.name}ï¼ˆ${m.type || 'ä¸æ˜'}ï¼‰`;
        div.onclick = () => {
          addMachineToGachaList(m);
          gachaMachineInput.value = "";
          gachaSuggestionsBox.innerHTML = "";
        };
        gachaSuggestionsBox.appendChild(div);
      });
    });

    gachaMachineInput.addEventListener("blur", () => {
      setTimeout(() => gachaSuggestionsBox.innerHTML = "", 200);
    });

    gachaGenreFilter.addEventListener("change", () => {
        gachaMachineInput.value = ""; // ã‚¸ãƒ£ãƒ³ãƒ«å¤‰æ›´æ™‚ã«å…¥åŠ›ã‚¯ãƒªã‚¢
        gachaSuggestionsBox.innerHTML = ""; // ã‚µã‚¸ã‚§ã‚¹ãƒˆã‚‚ã‚¯ãƒªã‚¢
    });

    /**
     * æ©Ÿç¨®ã‚’ã‚¬ãƒãƒ£ãƒªã‚¹ãƒˆã«è¿½åŠ ã™ã‚‹
     * @param {Object} machine - è¿½åŠ ã™ã‚‹æ©Ÿç¨®ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆ { name, type, genre }
     */
    function addMachineToGachaList(machine) {
      // æ—¢ã«ãƒªã‚¹ãƒˆã«è¿½åŠ ã•ã‚Œã¦ã„ã‚‹ã‹ãƒã‚§ãƒƒã‚¯ (æ©Ÿç¨®åã§åˆ¤æ–­)
      const isDuplicate = gachaMachines.some(m => normalizeName(m.name) === normalizeName(machine.name));
      if (isDuplicate) {
        alert("ã“ã®æ©Ÿç¨®ã¯æ—¢ã«ã‚¬ãƒãƒ£å¯¾è±¡ãƒªã‚¹ãƒˆã«è¿½åŠ ã•ã‚Œã¦ã„ã¾ã™ã€‚");
        return;
      }
      // ã‚¸ãƒ£ãƒ³ãƒ«æƒ…å ±ãŒãªã„å ´åˆã¯ã€ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆã§ãƒ‘ãƒã‚¹ãƒ­ã‚’è¨­å®š
      const machineWithGenre = { ...machine, genre: machine.genre || 'pachislot' }; 

      gachaMachines.push(machineWithGenre);
      localStorage.setItem("gachaMachines", JSON.stringify(gachaMachines));
      renderGachaMachines();
    }

    /**
     * é¸æŠã—ãŸæ©Ÿç¨®ã‚’ã‚¬ãƒãƒ£ãƒªã‚¹ãƒˆã‹ã‚‰å‰Šé™¤ã™ã‚‹
     */
    function removeSelectedMachines() {
      const selectedOptions = Array.from(machineSelection.options).filter(option => option.selected);
      if (selectedOptions.length === 0) {
        alert("å‰Šé™¤ã™ã‚‹å°ã‚’é¸æŠã—ã¦ãã ã•ã„ã€‚");
        return;
      }

      if (confirm(`${selectedOptions.length}ä»¶ã®å°ã‚’ã‚¬ãƒãƒ£å¯¾è±¡ãƒªã‚¹ãƒˆã‹ã‚‰å‰Šé™¤ã—ã¾ã™ã‹ï¼Ÿ`)) {
        // é¸æŠã•ã‚Œã¦ã„ãªã„ã‚‚ã®ã ã‘ã‚’æ®‹ã™
        const remainingMachines = gachaMachines.filter((_, index) => 
          !selectedOptions.some(option => Number(option.value) === index)
        );
        gachaMachines = remainingMachines;
        localStorage.setItem("gachaMachines", JSON.stringify(gachaMachines));
        renderGachaMachines();
      }
    }

    /**
     * ã‚¬ãƒãƒ£ã‚’å›ã™
     */
    gachaForm.addEventListener("submit", function(e) {
      e.preventDefault();
      if (gachaMachines.length === 0) {
        alert("ã‚¬ãƒãƒ£ã‚’å›ã™ã«ã¯ã€ã¾ãšå°ã‚’ãƒªã‚¹ãƒˆã«è¿½åŠ ã—ã¦ãã ã•ã„ï¼");
        return;
      }

      const randomIndex = Math.floor(Math.random() * gachaMachines.length);
      const recommendedMachine = gachaMachines[randomIndex];

      const genreIcon = recommendedMachine.genre === 'pachinko' ? 'ğŸ¯' : 'ğŸ°';

      gachaResultMachineName.textContent = `${genreIcon} ${recommendedMachine.name}`;
      gachaResultGenre.textContent = recommendedMachine.genre === 'pachinko' ? 'ãƒ‘ãƒãƒ³ã‚³' : 'ãƒ‘ãƒã‚¹ãƒ­';
      gachaResultType.textContent = recommendedMachine.type || 'ä¸æ˜';

      gachaResultDiv.style.display = "block"; // çµæœè¡¨ç¤ºã‚¨ãƒªã‚¢ã‚’è¡¨ç¤º
      window.scrollTo({ top: document.body.scrollHeight, behavior: 'smooth' }); // çµæœã¾ã§ã‚¹ã‚¯ãƒ­ãƒ¼ãƒ«
    });

    // åˆæœŸãƒ­ãƒ¼ãƒ‰æ™‚ã«ã‚¬ãƒãƒ£å¯¾è±¡ãƒªã‚¹ãƒˆã‚’ãƒ¬ãƒ³ãƒ€ãƒªãƒ³ã‚°
    loadMachinesForGacha();
  </script>
</body>
</html>