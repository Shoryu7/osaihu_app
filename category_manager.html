<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>å®¶è¨ˆç°¿ã‚¢ãƒ—ãƒª - ã‚«ãƒ†ã‚´ãƒªç®¡ç†</title>
  <link rel="stylesheet" href="style.css"> <!-- å…±é€šã‚¹ã‚¿ã‚¤ãƒ«ã‚’é©ç”¨ -->
  <style>
    /* ã‚«ãƒ†ã‚´ãƒªç®¡ç†ãƒšãƒ¼ã‚¸å°‚ç”¨ã®ã‚¹ã‚¿ã‚¤ãƒ« */
    /* .category-section ã¯ style.css ã«ç§»å‹• */

    /* .category-tabs ã¯ style.css ã«ç§»å‹• */
    /* .category-tab ã¯ style.css ã«ç§»å‹• */

    .add-category-form {
      display: flex;
      gap: 10px;
      margin-bottom: 20px;
    }

    .add-category-form input {
      flex-grow: 1;
    }

    /* .category-list ã¯ style.css ã«ç§»å‹• */

    /* .category-item ã¯ style.css ã«ç§»å‹• */

    .category-item .category-name {
      font-size: 16px;
      font-weight: 600;
      color: #333;
    }

    .category-item .category-actions {
      display: flex;
      gap: 10px;
    }

    /* .category-item .btn-small ã¯ style.css ã«ç§»å‹• */

    .category-item .btn-edit {
        background: #3498db; /* é’ */
        color: white;
    }

    .category-item .btn-delete {
        background: #e74c3c; /* èµ¤ */
        color: white;
    }

    /* ç·¨é›†ãƒ¢ãƒ¼ãƒ‰ç”¨ã®ã‚¹ã‚¿ã‚¤ãƒ« */
    .category-item.editing input {
        flex-grow: 1;
        margin-right: 10px;
        padding: 8px 12px;
        border: 1px solid #4CAF50;
        border-radius: 6px;
        font-size: 14px;
    }
    .category-item.editing .category-name {
        display: none;
    }
  </style>
</head>
<body>
  <div class="container">
    <div class="header">
      <h1>ğŸ·ï¸ ã‚«ãƒ†ã‚´ãƒªç®¡ç†</h1>
      <p>åæ”¯ã®ã‚«ãƒ†ã‚´ãƒªã‚’è‡ªç”±ã«è¨­å®šã—ã¾ã—ã‚‡ã†</p>
      <!-- ãƒŠãƒ“ã‚²ãƒ¼ã‚·ãƒ§ãƒ³ãƒªãƒ³ã‚¯ -->
      <div class="nav-links">
        <a href="index.html" class="nav-link">ğŸ  ãƒ›ãƒ¼ãƒ </a>
        <a href="calendar.html" class="nav-link">ğŸ“… ã‚«ãƒ¬ãƒ³ãƒ€ãƒ¼</a>
        <a href="graph.html" class="nav-link">ğŸ“Š ã‚°ãƒ©ãƒ•</a>
        <a href="pachinko_index.html" class="nav-link">ğŸ° ãƒ‘ãƒã‚¹ãƒ­åæ”¯</a>
      </div>
    </div>

    <div class="content">
      <div class="category-section">
        <h2>ã‚«ãƒ†ã‚´ãƒªã‚¿ã‚¤ãƒ—ã‚’é¸æŠ</h2>
        <div class="category-tabs">
          <div class="category-tab active" data-type="expense">æ”¯å‡ºã‚«ãƒ†ã‚´ãƒª</div>
          <div class="category-tab" data-type="income">åå…¥ã‚«ãƒ†ã‚´ãƒª</div>
        </div>
      </div>

      <div class="category-section">
        <h2>æ–°ã—ã„ã‚«ãƒ†ã‚´ãƒªã‚’è¿½åŠ </h2>
        <form id="add-category-form" class="add-category-form">
          <input type="text" id="new-category-name" placeholder="æ–°ã—ã„ã‚«ãƒ†ã‚´ãƒªå" required>
          <button type="submit" class="btn btn-small">è¿½åŠ </button>
        </form>
      </div>

      <div class="category-section">
        <h2>ã‚«ãƒ†ã‚´ãƒªãƒªã‚¹ãƒˆ</h2>
        <ul id="category-list" class="category-list">
          <!-- ã‚«ãƒ†ã‚´ãƒªã¯JavaScriptã§å‹•çš„ã«è¿½åŠ ã•ã‚Œã¾ã™ -->
        </ul>
      </div>
    </div>
  </div>

  <script>
    const CATEGORY_STORAGE_KEY = 'household_account_book_categories';
    let currentCategoryType = 'expense'; // 'expense' or 'income'

    document.addEventListener('DOMContentLoaded', () => {
      loadCategories();
      renderCategories();

      document.querySelectorAll('.category-tab').forEach(tab => {
        tab.addEventListener('click', (event) => {
          document.querySelector('.category-tab.active').classList.remove('active');
          event.target.classList.add('active');
          currentCategoryType = event.target.dataset.type;
          renderCategories();
        });
      });

      document.getElementById('add-category-form').addEventListener('submit', (event) => {
        event.preventDefault();
        const newCategoryNameInput = document.getElementById('new-category-name');
        const newCategoryName = newCategoryNameInput.value.trim();
        if (newCategoryName) {
          addCategory(newCategoryName, currentCategoryType);
          newCategoryNameInput.value = '';
        }
      });
    });

    function getCategories() {
      const categoriesJson = localStorage.getItem(CATEGORY_STORAGE_KEY);
      return categoriesJson ? JSON.parse(categoriesJson) : { income: [], expense: [] };
    }

    function saveCategories(categories) {
      localStorage.setItem(CATEGORY_STORAGE_KEY, JSON.stringify(categories));
    }

    function loadCategories() {
      const categories = getCategories();
      // ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆã‚«ãƒ†ã‚´ãƒªãŒå­˜åœ¨ã—ãªã„å ´åˆã«è¨­å®š
      if (categories.expense.length === 0 && categories.income.length === 0) {
        categories.expense = [
          { id: Date.now(), name: 'é£Ÿè²»' },
          { id: Date.now() + 1, name: 'äº¤é€šè²»' },
          { id: Date.now() + 2, name: 'å¨¯æ¥½è²»' },
          { id: Date.now() + 3, name: 'æ—¥ç”¨å“' }
        ];
        categories.income = [
          { id: Date.now() + 4, name: 'çµ¦ä¸' },
          { id: Date.now() + 5, name: 'è‡¨æ™‚åå…¥' }
        ];
        saveCategories(categories);
      }
    }

    function renderCategories() {
      const categoryList = document.getElementById('category-list');
      categoryList.innerHTML = ''; // ãƒªã‚¹ãƒˆã‚’ã‚¯ãƒªã‚¢

      const categories = getCategories();
      const currentTypeCategories = categories[currentCategoryType];

      if (currentTypeCategories.length === 0) {
        const emptyItem = document.createElement('li');
        emptyItem.textContent = `ç¾åœ¨ã€${currentCategoryType === 'expense' ? 'æ”¯å‡º' : 'åå…¥'}ã‚«ãƒ†ã‚´ãƒªã¯ç™»éŒ²ã•ã‚Œã¦ã„ã¾ã›ã‚“ã€‚`;
        emptyItem.style.textAlign = 'center';
        emptyItem.style.color = '#777';
        emptyItem.style.padding = '20px';
        categoryList.appendChild(emptyItem);
        return;
      }

      currentTypeCategories.forEach(category => {
        const listItem = document.createElement('li');
        listItem.classList.add('category-item');
        listItem.dataset.id = category.id;
        // ã‚«ãƒ†ã‚´ãƒªãƒªã‚¹ãƒˆã®ã‚¢ã‚¤ãƒ†ãƒ ã«ã¯border-leftãŒãªã„ãŸã‚ã€å‰Šé™¤
        listItem.style.borderLeft = 'none';

        listItem.innerHTML = `
          <span class="category-name">${category.name}</span>
          <div class="category-actions">
            <button class="btn btn-small btn-edit">ç·¨é›†</button>
            <button class="btn btn-small btn-delete">å‰Šé™¤</button>
          </div>
        `;
        categoryList.appendChild(listItem);
      });

      addCategoryEventListeners();
    }

    function addCategoryEventListeners() {
      document.querySelectorAll('.btn-edit').forEach(button => {
        button.addEventListener('click', (event) => {
          const listItem = event.target.closest('.category-item');
          toggleEditMode(listItem);
        });
      });

      document.querySelectorAll('.btn-delete').forEach(button => {
        button.addEventListener('click', (event) => {
          const listItem = event.target.closest('.category-item');
          deleteCategory(listItem.dataset.id, currentCategoryType);
        });
      });
    }

    function toggleEditMode(listItem) {
        if (listItem.classList.contains('editing')) {
            // ç·¨é›†ãƒ¢ãƒ¼ãƒ‰ã‹ã‚‰é€šå¸¸ãƒ¢ãƒ¼ãƒ‰ã¸ (ä¿å­˜)
            const input = listItem.querySelector('input[type="text"]');
            const newName = input.value.trim();
            if (newName) {
                updateCategory(listItem.dataset.id, newName, currentCategoryType);
            }
            listItem.classList.remove('editing');
            renderCategories(); // æ›´æ–°å¾Œã«å†æç”»
        } else {
            // é€šå¸¸ãƒ¢ãƒ¼ãƒ‰ã‹ã‚‰ç·¨é›†ãƒ¢ãƒ¼ãƒ‰ã¸
            listItem.classList.add('editing');
            const categoryNameSpan = listItem.querySelector('.category-name');
            const currentName = categoryNameSpan.textContent;

            const inputField = document.createElement('input');
            inputField.type = 'text';
            inputField.value = currentName;

            const saveButton = document.createElement('button');
            saveButton.classList.add('btn', 'btn-small', 'btn-edit');
            saveButton.textContent = 'ä¿å­˜';
            saveButton.addEventListener('click', () => {
                const newName = inputField.value.trim();
                if (newName) {
                    updateCategory(listItem.dataset.id, newName, currentCategoryType);
                }
                listItem.classList.remove('editing');
                renderCategories(); // ä¿å­˜å¾Œã«å†æç”»
            });

            const cancelButton = document.createElement('button');
            cancelButton.classList.add('btn', 'btn-small', 'btn-delete'); // ãƒ‡ã‚¶ã‚¤ãƒ³æµç”¨
            cancelButton.textContent = 'ã‚­ãƒ£ãƒ³ã‚»ãƒ«';
            cancelButton.addEventListener('click', () => {
                listItem.classList.remove('editing');
                renderCategories(); // ã‚­ãƒ£ãƒ³ã‚»ãƒ«å¾Œã«å†æç”»
            });

            const categoryActionsDiv = listItem.querySelector('.category-actions');
            categoryActionsDiv.innerHTML = ''; // æ—¢å­˜ã®ãƒœã‚¿ãƒ³ã‚’ã‚¯ãƒªã‚¢
            listItem.insertBefore(inputField, categoryActionsDiv);
            categoryActionsDiv.appendChild(saveButton);
            categoryActionsDiv.appendChild(cancelButton);

            inputField.focus();
        }
    }


    function addCategory(name, type) {
      const categories = getCategories();
      const newCategory = {
        id: Date.now(), // ãƒ¦ãƒ‹ãƒ¼ã‚¯ãªIDã‚’ç”Ÿæˆ
        name: name
      };
      categories[type].push(newCategory);
      saveCategories(categories);
      renderCategories();
    }

    function updateCategory(id, newName, type) {
      const categories = getCategories();
      const index = categories[type].findIndex(cat => cat.id == id);
      if (index !== -1) {
        categories[type][index].name = newName;
        saveCategories(categories);
      }
    }

    function deleteCategory(id, type) {
      if (!confirm('ã“ã®ã‚«ãƒ†ã‚´ãƒªã‚’å‰Šé™¤ã—ã¾ã™ã‹ï¼Ÿ\nã“ã®ã‚«ãƒ†ã‚´ãƒªã‚’ä½¿ç”¨ã—ã¦ã„ã‚‹åæ”¯è¨˜éŒ²ã¯å½±éŸ¿ã‚’å—ã‘ã¾ã›ã‚“ã€‚')) {
        return;
      }
      const categories = getCategories();
      categories[type] = categories[type].filter(cat => cat.id != id);
      saveCategories(categories);
      renderCategories();
    }

  </script>
</body>
</html>